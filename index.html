<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patto di Ferro</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        const Download = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const Target = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <circle cx="12" cy="12" r="6"></circle>
                <circle cx="12" cy="12" r="2"></circle>
            </svg>
        );

        const Zap = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
            </svg>
        );

        function PattoDiFerro() {
            const [goal, setGoal] = useState('');
            const [targetDate, setTargetDate] = useState('');
            const [userName, setUserName] = useState('');
            const [previewUrl, setPreviewUrl] = useState('');
            const canvasRef = useRef(null);

            const generateImage = () => {
                const canvas = canvasRef.current;
                if (!canvas || !goal || !targetDate) return;

                const ctx = canvas.getContext('2d');
                canvas.width = 1080;
                canvas.height = 1920;

                const qrImage = new Image();
                qrImage.crossOrigin = 'anonymous';
                qrImage.src = 'https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=https://nicholasrubini.it&color=60a5fa&bgcolor=0a0e1a';
                
                const drawCanvas = (qrImg) => {
                    const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
                    gradient.addColorStop(0, '#0a0e1a');
                    gradient.addColorStop(0.3, '#0f1d3d');
                    gradient.addColorStop(0.7, '#1a2642');
                    gradient.addColorStop(1, '#050810');
                    ctx.fillStyle = gradient;
                    ctx.fillRect(0, 0, canvas.width, canvas.height);

                    ctx.strokeStyle = 'rgba(100, 150, 255, 0.06)';
                    ctx.lineWidth = 2;
                    const chevronSize = 60;
                    for (let y = 0; y < canvas.height; y += chevronSize) {
                        for (let x = 0; x < canvas.width; x += chevronSize * 2) {
                            ctx.beginPath();
                            ctx.moveTo(x, y);
                            ctx.lineTo(x + chevronSize, y + chevronSize / 2);
                            ctx.lineTo(x, y + chevronSize);
                            ctx.stroke();
                        }
                    }
                    
                    ctx.strokeStyle = 'rgba(100, 150, 255, 0.15)';
                    ctx.lineWidth = 3;
                    ctx.beginPath();
                    ctx.moveTo(50, 50);
                    ctx.lineTo(100, 50);
                    ctx.lineTo(75, 100);
                    ctx.closePath();
                    ctx.stroke();
                    
                    ctx.beginPath();
                    ctx.moveTo(980, 50);
                    ctx.lineTo(1030, 50);
                    ctx.lineTo(1005, 100);
                    ctx.closePath();
                    ctx.stroke();

                    const glowGradient1 = ctx.createRadialGradient(200, 300, 0, 200, 300, 400);
                    glowGradient1.addColorStop(0, 'rgba(50, 150, 255, 0.15)');
                    glowGradient1.addColorStop(1, 'rgba(50, 150, 255, 0)');
                    ctx.fillStyle = glowGradient1;
                    ctx.fillRect(0, 0, canvas.width, 600);

                    const glowGradient2 = ctx.createRadialGradient(880, 1500, 0, 880, 1500, 400);
                    glowGradient2.addColorStop(0, 'rgba(100, 180, 255, 0.12)');
                    glowGradient2.addColorStop(1, 'rgba(100, 180, 255, 0)');
                    ctx.fillStyle = glowGradient2;
                    ctx.fillRect(400, 1100, canvas.width, 800);

                    const metalGradient = ctx.createLinearGradient(0, 0, canvas.width, 0);
                    metalGradient.addColorStop(0, 'rgba(192, 192, 192, 0.3)');
                    metalGradient.addColorStop(0.5, 'rgba(230, 230, 250, 0.6)');
                    metalGradient.addColorStop(1, 'rgba(192, 192, 192, 0.3)');
                    ctx.fillStyle = metalGradient;
                    ctx.fillRect(0, 0, canvas.width, 10);

                    ctx.fillStyle = '#3b82f6';
                    ctx.fillRect(0, 10, canvas.width, 4);

                    ctx.shadowColor = 'rgba(59, 130, 246, 0.8)';
                    ctx.shadowBlur = 30;
                    ctx.fillStyle = '#e6e6fa';
                    ctx.font = 'bold 90px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('PATTO DI FERRO', canvas.width / 2, 220);
                    ctx.shadowBlur = 0;
                    
                    ctx.strokeStyle = '#60a5fa';
                    ctx.lineWidth = 3;
                    ctx.lineCap = 'square';
                    
                    ctx.beginPath();
                    ctx.moveTo(120, 200);
                    ctx.lineTo(120, 240);
                    ctx.moveTo(105, 210);
                    ctx.lineTo(120, 200);
                    ctx.lineTo(135, 210);
                    ctx.stroke();
                    
                    ctx.beginPath();
                    ctx.moveTo(940, 200);
                    ctx.lineTo(960, 220);
                    ctx.lineTo(940, 240);
                    ctx.moveTo(960, 200);
                    ctx.lineTo(940, 220);
                    ctx.lineTo(960, 240);
                    ctx.stroke();

                    const lineGradient = ctx.createLinearGradient(290, 0, 790, 0);
                    lineGradient.addColorStop(0, 'rgba(59, 130, 246, 0)');
                    lineGradient.addColorStop(0.5, '#3b82f6');
                    lineGradient.addColorStop(1, 'rgba(59, 130, 246, 0)');
                    ctx.fillStyle = lineGradient;
                    ctx.fillRect(290, 250, 500, 5);

                    if (userName.trim()) {
                        ctx.shadowColor = 'rgba(59, 130, 246, 0.6)';
                        ctx.shadowBlur = 20;
                        ctx.fillStyle = '#a5b4fc';
                        ctx.font = 'bold 52px Arial';
                        ctx.fillText(userName.toUpperCase(), canvas.width / 2, 360);
                        ctx.shadowBlur = 0;
                    }

                    ctx.fillStyle = '#60a5fa';
                    ctx.font = 'bold 48px Arial';
                    ctx.fillText('IL MIO OBIETTIVO:', canvas.width / 2, userName ? 480 : 420);

                    ctx.fillStyle = 'rgba(96, 165, 250, 0.3)';
                    ctx.fillRect(240, userName ? 505 : 445, 600, 2);

                    ctx.shadowColor = 'rgba(230, 230, 250, 0.5)';
                    ctx.shadowBlur = 15;
                    ctx.fillStyle = '#f1f5f9';
                    ctx.font = 'bold 75px Arial';
                    const maxWidth = 900;
                    const words = goal.split(' ');
                    let line = '';
                    let y = userName ? 610 : 550;
                    const lineHeight = 95;

                    words.forEach((word, index) => {
                        const testLine = line + word + ' ';
                        const metrics = ctx.measureText(testLine);
                        if (metrics.width > maxWidth && index > 0) {
                            ctx.fillText(line, canvas.width / 2, y);
                            line = word + ' ';
                            y += lineHeight;
                        } else {
                            line = testLine;
                        }
                    });
                    ctx.fillText(line, canvas.width / 2, y);
                    ctx.shadowBlur = 0;

                    ctx.fillStyle = 'rgba(96, 165, 250, 0.3)';
                    ctx.fillRect(240, y + 30, 600, 2);

                    if (targetDate) {
                        const dateObj = new Date(targetDate);
                        const options = { day: 'numeric', month: 'long', year: 'numeric' };
                        const formattedDate = dateObj.toLocaleDateString('it-IT', options);

                        const boxY = y + 120;
                        const boxHeight = 220;
                        
                        const boxGradient = ctx.createLinearGradient(0, boxY, 0, boxY + boxHeight);
                        boxGradient.addColorStop(0, 'rgba(30, 58, 138, 0.4)');
                        boxGradient.addColorStop(1, 'rgba(30, 64, 175, 0.2)');
                        ctx.fillStyle = boxGradient;
                        ctx.fillRect(190, boxY, 700, boxHeight);

                        ctx.strokeStyle = '#3b82f6';
                        ctx.lineWidth = 3;
                        ctx.strokeRect(190, boxY, 700, boxHeight);

                        ctx.fillStyle = '#60a5fa';
                        ctx.fillRect(190, boxY, 40, 3);
                        ctx.fillRect(190, boxY, 3, 40);
                        ctx.fillRect(195, boxY + 8, 25, 2);
                        ctx.fillRect(195, boxY + 8, 2, 25);
                        ctx.fillRect(850, boxY, 40, 3);
                        ctx.fillRect(887, boxY, 3, 40);
                        ctx.fillRect(860, boxY + 8, 25, 2);
                        ctx.fillRect(883, boxY + 8, 2, 25);
                        ctx.fillRect(190, boxY + boxHeight - 3, 40, 3);
                        ctx.fillRect(190, boxY + boxHeight - 40, 3, 40);
                        ctx.fillRect(195, boxY + boxHeight - 33, 25, 2);
                        ctx.fillRect(195, boxY + boxHeight - 33, 2, 25);
                        ctx.fillRect(850, boxY + boxHeight - 3, 40, 3);
                        ctx.fillRect(887, boxY + boxHeight - 40, 3, 40);
                        ctx.fillRect(860, boxY + boxHeight - 33, 25, 2);
                        ctx.fillRect(883, boxY + boxHeight - 33, 2, 25);
                        
                        ctx.strokeStyle = '#3b82f6';
                        ctx.lineWidth = 2;
                        ctx.beginPath();
                        ctx.moveTo(210, boxY + 20);
                        ctx.lineTo(220, boxY + 15);
                        ctx.lineTo(230, boxY + 20);
                        ctx.lineTo(220, boxY + 30);
                        ctx.closePath();
                        ctx.stroke();
                        
                        ctx.beginPath();
                        ctx.moveTo(850, boxY + 20);
                        ctx.lineTo(860, boxY + 15);
                        ctx.lineTo(870, boxY + 20);
                        ctx.lineTo(860, boxY + 30);
                        ctx.closePath();
                        ctx.stroke();

                        ctx.fillStyle = '#60a5fa';
                        ctx.font = 'bold 45px Arial';
                        ctx.fillText('ENTRO IL:', canvas.width / 2, boxY + 75);

                        ctx.shadowColor = 'rgba(96, 165, 250, 0.8)';
                        ctx.shadowBlur = 20;
                        ctx.fillStyle = '#e0e7ff';
                        ctx.font = 'bold 62px Arial';
                        ctx.fillText(formattedDate.toUpperCase(), canvas.width / 2, boxY + 155);
                        ctx.shadowBlur = 0;
                    }

                    const badgeY = 1580;
                    const hexSize = 140;
                    
                    ctx.beginPath();
                    for (let i = 0; i < 6; i++) {
                        const angle = (Math.PI / 3) * i;
                        const x = canvas.width / 2 + hexSize * Math.cos(angle);
                        const y = badgeY + hexSize * Math.sin(angle);
                        if (i === 0) ctx.moveTo(x, y);
                        else ctx.lineTo(x, y);
                    }
                    ctx.closePath();

                    const hexGradient = ctx.createRadialGradient(canvas.width / 2, badgeY, 0, canvas.width / 2, badgeY, hexSize);
                    hexGradient.addColorStop(0, 'rgba(30, 58, 138, 0.6)');
                    hexGradient.addColorStop(1, 'rgba(15, 23, 42, 0.8)');
                    ctx.fillStyle = hexGradient;
                    ctx.fill();

                    ctx.strokeStyle = '#3b82f6';
                    ctx.lineWidth = 5;
                    ctx.stroke();

                    ctx.beginPath();
                    for (let i = 0; i < 6; i++) {
                        const angle = (Math.PI / 3) * i;
                        const x = canvas.width / 2 + (hexSize - 20) * Math.cos(angle);
                        const y = badgeY + (hexSize - 20) * Math.sin(angle);
                        if (i === 0) ctx.moveTo(x, y);
                        else ctx.lineTo(x, y);
                    }
                    ctx.closePath();
                    ctx.strokeStyle = '#60a5fa';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    
                    ctx.strokeStyle = 'rgba(96, 165, 250, 0.2)';
                    ctx.lineWidth = 3;
                    const valknutSize = 80;
                    const valknutY = badgeY;
                    
                    ctx.beginPath();
                    ctx.moveTo(canvas.width / 2 - valknutSize / 2, valknutY + valknutSize / 3);
                    ctx.lineTo(canvas.width / 2, valknutY - valknutSize / 2);
                    ctx.lineTo(canvas.width / 2 + valknutSize / 2, valknutY + valknutSize / 3);
                    ctx.closePath();
                    ctx.stroke();
                    
                    ctx.beginPath();
                    ctx.moveTo(canvas.width / 2 - valknutSize / 3, valknutY - valknutSize / 4);
                    ctx.lineTo(canvas.width / 2 - valknutSize / 1.5, valknutY + valknutSize / 2.5);
                    ctx.lineTo(canvas.width / 2, valknutY + valknutSize / 4);
                    ctx.closePath();
                    ctx.stroke();
                    
                    ctx.beginPath();
                    ctx.moveTo(canvas.width / 2 + valknutSize / 3, valknutY - valknutSize / 4);
                    ctx.lineTo(canvas.width / 2 + valknutSize / 1.5, valknutY + valknutSize / 2.5);
                    ctx.lineTo(canvas.width / 2, valknutY + valknutSize / 4);
                    ctx.closePath();
                    ctx.stroke();

                    ctx.shadowColor = 'rgba(96, 165, 250, 0.8)';
                    ctx.shadowBlur = 15;
                    ctx.fillStyle = '#e0e7ff';
                    ctx.font = 'bold 50px Arial';
                    ctx.fillText('GIURO', canvas.width / 2, badgeY - 15);
                    ctx.font = 'bold 42px Arial';
                    ctx.fillText('PUBBLICAMENTE', canvas.width / 2, badgeY + 35);
                    ctx.shadowBlur = 0;

                    if (qrImg && qrImg.complete) {
                        const qrSize = 100;
                        const qrX = 80;
                        const qrY = 1780;
                        ctx.fillStyle = 'rgba(10, 14, 26, 0.9)';
                        ctx.fillRect(qrX - 10, qrY - 10, qrSize + 20, qrSize + 20);
                        ctx.strokeStyle = '#3b82f6';
                        ctx.lineWidth = 3;
                        ctx.strokeRect(qrX - 10, qrY - 10, qrSize + 20, qrSize + 20);
                        ctx.drawImage(qrImg, qrX, qrY, qrSize, qrSize);
                    }

                    ctx.fillStyle = 'rgba(200, 215, 240, 0.8)';
                    ctx.font = '34px Arial';
                    ctx.textAlign = 'right';
                    ctx.fillText('@nicholasrubini', canvas.width - 80, 1840);

                    ctx.fillStyle = metalGradient;
                    ctx.fillRect(0, canvas.height - 10, canvas.width, 10);
                    ctx.fillStyle = '#3b82f6';
                    ctx.fillRect(0, canvas.height - 14, canvas.width, 4);

                    setPreviewUrl(canvas.toDataURL('image/png'));
                };
                
                qrImage.onload = () => drawCanvas(qrImage);
                qrImage.onerror = () => drawCanvas(null);
                drawCanvas(null);
            };

            const downloadImage = () => {
                if (!goal || !targetDate) return;
                generateImage();
                setTimeout(() => {
                    const canvas = canvasRef.current;
                    if (!canvas) return;
                    canvas.toBlob((blob) => {
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = 'patto-di-ferro-instagram-story.png';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        URL.revokeObjectURL(url);
                    }, 'image/png');
                }, 200);
            };

            useEffect(() => {
                if (goal && targetDate) {
                    generateImage();
                }
            }, [goal, targetDate, userName]);

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-950 via-blue-950 to-slate-900 text-white p-4 md:p-8">
                    <div className="max-w-6xl mx-auto">
                        <div className="text-center mb-8 md:mb-12">
                            <div className="flex items-center justify-center gap-3 mb-4">
                                <Zap />
                                <h1 className="text-4xl md:text-6xl font-bold tracking-tight bg-gradient-to-r from-slate-200 via-blue-200 to-slate-300 bg-clip-text text-transparent">
                                    PATTO DI FERRO
                                </h1>
                                <Zap />
                            </div>
                            <p className="text-lg md:text-xl text-slate-300 max-w-2xl mx-auto">
                                Dichiara il tuo obiettivo di performance al mondo. Niente scuse. Solo risultati.
                            </p>
                            <div className="mt-4 text-sm text-slate-400">
                                by <span className="text-blue-400 font-semibold">NicholasRubini.it</span>
                            </div>
                        </div>

                        <div className="grid md:grid-cols-2 gap-8 items-start">
                            <div className="bg-slate-900/60 backdrop-blur border border-blue-900/30 rounded-lg p-6 md:p-8 shadow-xl shadow-blue-900/20">
                                <div className="flex items-center gap-2 mb-6">
                                    <Target />
                                    <h2 className="text-2xl font-bold">Crea il tuo patto</h2>
                                </div>

                                <div className="space-y-6">
                                    <div>
                                        <label className="block text-sm font-semibold text-blue-400 mb-2">
                                            Il tuo nome (opzionale)
                                        </label>
                                        <input
                                            type="text"
                                            value={userName}
                                            onChange={(e) => setUserName(e.target.value)}
                                            placeholder="Es: Marco Rossi"
                                            className="w-full bg-slate-950/80 border border-blue-900/50 rounded px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-semibold text-blue-400 mb-2">
                                            Il tuo obiettivo di performance *
                                        </label>
                                        <textarea
                                            value={goal}
                                            onChange={(e) => setGoal(e.target.value)}
                                            placeholder="Es: Deadlift 200kg • Correre 10km sotto i 45 min • 20 pull-up di fila"
                                            rows="4"
                                            className="w-full bg-slate-950/80 border border-blue-900/50 rounded px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition resize-none"
                                            required
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-semibold text-blue-400 mb-2">
                                            Data obiettivo *
                                        </label>
                                        <input
                                            type="date"
                                            value={targetDate}
                                            onChange={(e) => setTargetDate(e.target.value)}
                                            className="w-full bg-slate-950/80 border border-blue-900/50 rounded px-4 py-3 text-white focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition"
                                            required
                                        />
                                    </div>

                                    <button
                                        onClick={downloadImage}
                                        disabled={!goal || !targetDate}
                                        className="w-full bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 disabled:from-slate-600 disabled:to-slate-700 disabled:cursor-not-allowed text-white font-bold py-4 rounded-lg flex items-center justify-center gap-3 transition-all transform hover:scale-105 disabled:hover:scale-100 shadow-lg shadow-blue-900/50 disabled:shadow-none"
                                    >
                                        <Download />
                                        ⚔️ Scarica e Giura
                                    </button>

                                    <p className="text-xs text-slate-400 text-center">
                                        Immagine ottimizzata per Instagram Stories (1080x1920px)
                                    </p>
                                </div>
                            </div>

                            <div className="bg-slate-900/60 backdrop-blur border border-blue-900/30 rounded-lg p-6 shadow-xl shadow-blue-900/20">
                                <h3 className="text-xl font-bold mb-4 text-center">Anteprima</h3>
                                <div className="relative mx-auto" style={{ maxWidth: '360px' }}>
                                    <canvas ref={canvasRef} className="hidden" />
                                    {previewUrl ? (
                                        <img 
                                            src={previewUrl} 
                                            alt="Preview" 
                                            className="w-full h-auto border-2 border-blue-900/50 rounded-lg shadow-2xl shadow-blue-900/30"
                                            style={{ aspectRatio: '9/16' }}
                                        />
                                    ) : (
                                        <div className="w-full bg-slate-950/80 border-2 border-blue-900/50 rounded-lg flex items-center justify-center shadow-2xl" style={{ aspectRatio: '9/16' }}>
                                            <p className="text-slate-400 text-center px-4">
                                                Compila i campi per vedere l'anteprima
                                            </p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>

                        <div className="mt-12 text-center bg-gradient-to-r from-blue-900/20 via-slate-900/40 to-blue-900/20 border border-blue-900/30 rounded-lg p-6 md:p-8 shadow-xl shadow-blue-900/20">
                            <h3 className="text-2xl font-bold mb-3 bg-gradient-to-r from-slate-200 to-blue-200 bg-clip-text text-transparent">
                                Fatto da un vichingo per vichinghi
                            </h3>
                            <p className="text-slate-300 mb-4">
                                Vuoi altri strumenti per warriors? Scopri il metodo completo.
                            </p>
                            
                                href="https://nicholasrubini.it"
                                target="_blank"
                                rel="noopener noreferrer"
                                className="inline-block bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white font-bold px-8 py-3 rounded-lg transition-all transform hover:scale-105 shadow-lg shadow-blue-900/50"
                            >
                                Visita NicholasRubini.it
                            </a>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<PattoDiFerro />, document.getElementById('root'));
    </script>
</body>
</html>
